#!/bin/bash
clear
echo "BoredInstaller"
echo "---"
echo "You are about to install boredbutton."
echo "It will be saved to "~"/bin/."
echo "Press the R button to restore the previous version, and any other button to continue."
echo "(Note: this will overwrite your existing installation.)"
echo "(Tip: to skip this warning entirely, use bored --skipconfirm.)"
if [ -z "$1" ]
then
	read -ren1 restore
else
	echo "-Z 3" 
	if [ ! "$1" = "--skipconfirm" ]
	then 
		read -ren1 restore
	fi
fi
if [ "$restore" = "r" ]
then
	clear
	echo "[=   ]"
	echo "Finding backup paths..."
	if [ -d "~/.bored.old" ]
	then
		clear
		echo "[==  ]"
		echo "Restoring backup..."
		mv -f ~/.bored.old ~/.bored
		clear
		echo "[=== ]"
		echo "Restoring backup..."
		mv -f ~/bin/bored.old ~/bin/bored
		clear
		echo "[====]"
		echo "Done!"
	else
		clear
		echo "[xxxx]"
		echo "FAILED"
		echo "No backup found!"
	fi
fi		
clear
echo "[     ]"
echo "Backing up the old version..."
if [ -e ~/bin/bored ]; then rm -f ~/bin/bored.old && mv ~/bin/bored ~/bin/bored.old; fi
if [ -e ~/bin/idealist.txt ]; then rm -f ~/bin/idealist.txt; fi
clear
echo "[=    ]"
echo "Making local bin folder..."
pathfix="export PATH=$PATH:~/bin"
grep -q -F '$pathfix' ~/.bashrc || echo '$pathfix' >> ~/.bashrc
if ! [ -d ~/bin ]; then mkdir ~/bin; fi
clear
echo "[==   ]"
echo "Copying idea list..."
cp -f defaultlist.txt ~/.bored/defaultlist.txt
cp -f defaultnoid.txt ~/.bored/defaultnoid.txt
clear
echo "[===  ]"
echo "Building the utility..."
while read -r line
do
    if [[ $line == source* ]]
    then
        cat ${line:7} >> ~/bin/bored
    else
        echo "$line" >> ~/bin/bored
    fi
done < "bored"
clear
echo "[==== ]"
echo "Fixing permissions..."
chmod 755 ~/bin/bored
clear
echo "[=====]"
echo "Done!"
echo "Run boredbutton using the bored command."
